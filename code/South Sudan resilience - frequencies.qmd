---
title: "Household income and consumption"
subtitle: "Survey frequencies"
author: "Dan Killian"
toc: true
number-sections: true
format: 
  html:
    code-fold: true
editor: visual
---

```{r global_options, include=F, warning=F, message=F, echo=F, error=F}

# standard figure size and generate clean output
knitr::opts_chunk$set(autodep=T, fig.height=4, fig.width=6, warning=FALSE, message=FALSE, cache=TRUE, error=T, echo=T)

library(here)
source("00 South Sudan resilience - prep.R")
```

# Household Income and Consumption

```{r}
inc_out <- svyrdat %>%
  group_by() %>%
  summarize(crop_production=survey_mean(q_401_a_bin),
            cattle_production = survey_mean(q_401_b_bin),
            goat_production = survey_mean(q_401_c_bin),
            sheep_production = survey_mean(q_401_d_bin),
            fishing = survey_mean(q_401_e_bin),
            Agwage_within = survey_mean(q_401_f_bin),
            Agwage_without = survey_mean(q_401_g_bin),
            nonAgwage_within = survey_mean(q_401_h_bin),
            nonAgwage_without = survey_mean(q_401_i_bin),
            salary = survey_mean(q_401_j_bin),
            bush_products = survey_mean(q_401_k_bin),
            honey = survey_mean(q_401_l_bin),
            petty_trade_other = survey_mean(q_401_m_bin),
            petty_trade_own = survey_mean(q_401_n_bin),
            ownbiz_ag = survey_mean(q_401_o_bin), 
            ownbiz_nonag = survey_mean(q_401_p_bin),
            rent = survey_mean(q_401_q_bin),
            remit = survey_mean(q_401_r_bin),
            gifts = survey_mean(q_401_s_bin),
            safety_net = survey_mean(q_401_t_bin)) 

```

```{r}
mn_cols <- seq_len(40) %%2

inc_mn <- inc_out[, mn_cols==T] %>%
  t() %>%
  as.data.frame() %>%
  rownames_to_column()


inc_se <- inc_out[,mn_cols==F] %>%
  t() %>%
  as.data.frame()

inc_frq <- inc_mn %>%
  bind_cols(inc_se) %>%
  set_names(nm=c("income_source","mean","se")) %>%
  mutate(margin=se*1.96,
         lower=mean-1.96*margin,
         upper=mean+1.96*margin,
         inc_lab=inc_labs) %>%
  relocate(inc_lab, .after=income_source)

inc_gt <- inc_frq %>%
  arrange(desc(mean)) %>%
  gt() %>%
  fmt_percent(3:7,
              decimals=1)

inc_gt

```

```{inc_out}
```

# Household involvement in the community

## Community group participation

```{r}

grps_sum <- read_csv(here("output/tables/resilience/groups weighted.csv"))

grps_sum_gt <- grps_sum %>%
  gt()

grps_sum_gt
```
